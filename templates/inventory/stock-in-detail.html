{% extends "layout.html" %}
{% load static %}
{% block content %}

<div class="page-wrapper">
<div class="content">
<div class="page-header">
<div class="page-title">
<h4>Stock In Details</h4>
<h6>Entry ID - #{{ stock_in.id }}</h6>
</div>
<div class="page-btn">
<a href="{% url 'stock_in_list' %}" class="btn btn-secondary">
<i class="fas fa-arrow-left me-1"></i>Back
</a>
</div>
</div>

<div class="row">
<div class="col-lg-8 col-sm-12">

<div class="card">
<div class="card-body">
<div class="card-header-custom pb-3 mb-3">
<h5 class="card-title">
    <i class="fas fa-info-circle me-2"></i>Stock In Information
</h5>
</div>

<div class="row">
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Stock In ID:</label>
        <p class="mb-0"><strong class="text-primary">#{{ stock_in.id }}</strong></p>
    </div>
</div>
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Entry Date:</label>
        <p class="mb-0">
            <i class="far fa-calendar me-1"></i>
            {{ stock_in.created_at|date:"d/m/Y H:i" }}
        </p>
    </div>
</div>
</div>
<div class="row">
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Created By:</label>
        <p class="mb-0"><i class="fas fa-user me-1"></i>{{ stock_in.created_by.username }}</p>
    </div>
</div>
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Status:</label>
        {% if stock_in.is_disable %}
        <span class="badge bg-danger"><i class="fas fa-times-circle me-1"></i>Cancelled</span>
        {% elif stock_in.approved_by %}
        <span class="badge bg-success"><i class="fas fa-check-circle me-1"></i>Approved</span>
        {% else %}
        <span class="badge bg-warning text-dark"><i class="fas fa-clock me-1"></i>Pending</span>
        {% endif %}
    </div>
</div>
</div>
{% if stock_in.note %}
<div class="row">
<div class="col-12">
    <div class="alert alert-info">
        <i class="fas fa-sticky-note me-2"></i><strong>Note:</strong> {{ stock_in.note }}
    </div>
</div>
</div>
{% endif %}
</div>
</div>

<div class="card mt-4">
<div class="card-body">
<div class="card-header-custom pb-3 mb-3">
<h5 class="card-title">
    <i class="fas fa-truck me-2"></i>Supplier Information
</h5>
</div>

<div class="row">
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Supplier Name:</label>
        <p class="mb-0"><strong>{{ stock_in.supplier.name }}</strong></p>
    </div>
</div>
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Contact Person:</label>
        <p class="mb-0">{{ stock_in.supplier.contact_person }}</p>
    </div>
</div>
</div>
<div class="row">
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Phone Number:</label>
        <p class="mb-0"><a href="tel:{{ stock_in.supplier.phone }}">{{ stock_in.supplier.phone }}</a></p>
    </div>
</div>
<div class="col-lg-6 col-sm-6 col-12">
    <div class="info-item mb-3">
        <label class="text-muted">Email:</label>
        <p class="mb-0"><a href="mailto:{{ stock_in.supplier.email }}">{{ stock_in.supplier.email }}</a></p>
    </div>
</div>
</div>
<div class="row">
<div class="col-12">
    <div class="info-item">
        <label class="text-muted">Address:</label>
        <p class="mb-0">{{ stock_in.supplier.address }}</p>
    </div>
</div>
</div>
</div>
</div>

<div class="card mt-4">
<div class="card-body">
<div class="card-header-custom pb-3 mb-3">
<h5 class="card-title">
    <i class="fas fa-box me-2"></i>Product Information
</h5>
</div>
<div class="row">
<div class="col-lg-3 col-sm-12 text-center mb-3">
    {% if stock_in.product.image %}
    <img src="{{ stock_in.product.image.url }}" alt="product" class="img-fluid rounded" style="max-height: 100px;">
    {% else %}
    <img src="{% static 'assets/img/product/noimage.png' %}" alt="Category Image" class="img-fluid rounded" style="max-height: 100px;">
    {% endif %}
</div>
<div class="col-lg-9 col-sm-12">
    <div class="row">
        <div class="col-lg-6 col-sm-6 col-12">
            <div class="info-item mb-3">
                <label class="text-muted">Product Name:</label>
                <p class="mb-0"><strong>{{ stock_in.product.name }}</strong></p>
            </div>
        </div>
        <div class="col-lg-6 col-sm-6 col-12">
            <div class="info-item mb-3">
                <label class="text-muted">SKU / ID:</label>
                <p class="mb-0">{{ stock_in.product.product_id }}</p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 col-sm-6 col-12">
            <div class="info-item mb-3">
                <label class="text-muted">Category:</label>
                <p class="mb-0"><span class="badge bg-info">{{ stock_in.product.category.name }}</span></p>
            </div>
        </div>
        <div class="col-lg-6 col-sm-6 col-12">
            <div class="info-item mb-3">
                <label class="text-muted">Unit:</label>
                <p class="mb-0">{{ stock_in.product.unit }}</p>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>
</div>

<div class="col-lg-4 col-sm-12">
<div class="card">
<div class="card-body">
<div class="card-header-custom pb-3 mb-3">
<h5 class="card-title">
<i class="fas fa-user-shield me-2"></i>Approval Information
</h5>
</div>

<div class="info-item mb-3">
<label class="text-muted">Approver:</label>
{% if stock_in.approved_by %}
<p class="mb-0">
    <strong class="text-success">{{ stock_in.approved_by.get_full_name|default:stock_in.approved_by.username }}</strong>
</p>
{% else %}
<p class="mb-0"><strong class="text-warning">Pending approval</strong></p>
{% endif %}
</div>

<div class="info-item mb-3">
<label class="text-muted">Approval date:</label>
<p class="mb-0">
{% if stock_in.approved_by %}
    <i class="far fa-calendar-check me-1"></i>{{ stock_in.update_at|date:"d/m/Y H:i" }}
{% else %}
    <i class="far fa-minus-square me-1"></i>Unknown
{% endif %}
</p>
</div>
</div>
</div>
<div class="card">
<div class="card-body">
<div class="card-header-custom pb-3 mb-3">
<h5 class="card-title"><i class="fas fa-cogs me-2"></i>Actions</h5>
</div>
{% if user.role != 'admin' %}
<div class="alert alert-secondary text-center mb-2"><i class="fas fa-lock me-1"></i>Only Admin can approve</div>
{% elif stock_in.approved_by %}
<div class="alert alert-info text-center mb-2"><i class="fas fa-check me-1"></i>Approved</div>
{% elif not stock_in.is_disable %}
<a href="{% url 'confirm_stock_in' stock_in.id %}" class="btn btn-success w-100 mb-2" onclick="return confirm('Confirm and add stock?')"><i class="fas fa-check-circle me-1"></i>Confirm & Stock In</a>
{% endif %}

<a href="{% url 'print_stock_in' stock_in.id %}" class="btn btn-outline-primary w-100 mb-2" target="_blank"><i class="fas fa-print me-1"></i>Print Slip</a>

{% if user.role == 'admin' and not stock_in.is_disable %}
<a href="{% url 'cancel_stock_in' stock_in.id %}" class="btn btn-danger w-100" onclick="return confirm('Cancel this stock in?\n\nNote: Inventory will be reverted!')"><i class="fas fa-times-circle me-1"></i>Cancel Stock In</a>
{% elif user.role == 'admin' %}
<div class="alert alert-secondary text-center mb-0"><i class="fas fa-lock me-1"></i>Stock In Cancelled</div>
{% endif %}
</div>
</div>

<div class="card mt-4">
<div class="card-body">
<div class="card-header-custom pb-3 mb-3">
<h5 class="card-title">
    <i class="fas fa-calculator me-2"></i>Transaction Details
</h5>
</div>

<ul class="list-group list-group-flush">
<li class="list-group-item d-flex justify-content-between align-items-center px-0">
    <span><i class="fas fa-plus-circle text-success me-2"></i>Quantity In</span>
    <span class="fw-bold text-success fs-5">
        +{{ stock_in.quantity }} {{ stock_in.product.unit }}
    </span>
</li>

<li class="list-group-item d-flex justify-content-between align-items-center px-0 bg-light">
    <span><i class="fas fa-warehouse text-info me-2"></i>Post-Entry Stock</span>
    <span class="fw-bold text-dark">
        {% if stock_in.updated_quantity %}
            {{ stock_in.updated_quantity }} {{ stock_in.product.unit }}
        {% else %}
            <span class="text-muted fst-italic">--</span>
        {% endif %}
    </span>
</li>

<li class="list-group-item d-flex justify-content-between align-items-center px-0 mt-2">
    <span class="text-muted">Unit Price</span>
    <span>{{ stock_in.unit_price|floatformat:0 }} ₫</span>
</li>

<li class="list-group-item d-flex justify-content-between align-items-center px-0">
    <span class="fw-bold">Total Cost</span>
    <span class="fw-bold text-primary fs-5">{{ stock_in.total_cost|floatformat:0 }} ₫</span>
</li>
</ul>
</div>
</div>



</div>
</div>
</div>
</div>

{% endblock %}