{% extends "layout.html" %}
{% load static %}
{% block content %}

<div class="page-wrapper">
<div class="content">
<div class="page-header">
<div class="page-title">
<h4><i data-feather="cpu"></i> AI Demand Forecasting</h4>
<h6>Predict product demand using AI</h6>
</div>
</div>

<div class="card">
<div class="card-body">
<form method="post">
{% csrf_token %}
<div class="row">
<div class="col-lg-6">
<div class="form-group">
<label>Select Product</label>
<select name="product_id" class="form-control" required>
<option value="">Choose...</option>
{% for product in products %}
<option value="{{ product.id }}" {% if selected and selected.id == product.id %}selected{% endif %}>
{{ product.name }} - {{ product.category.name|default:"Uncategorized" }}
</option>
{% endfor %}
</select>
</div>
</div>

<div class="col-lg-3">
<div class="form-group">
<label>Forecast Days</label>
<select name="days" class="form-control">
<option value="7" selected>7 days</option>
<option value="14">14 days</option>
<option value="30">30 days</option>
</select>
</div>
</div>

<div class="col-lg-3">
<div class="form-group">
<label>&nbsp;</label>
<button type="submit" class="btn btn-primary btn-block">
<i data-feather="trending-up"></i> Forecast
</button>
</div>
</div>
</div>
</form>
</div>
</div>

{% if result %}
<div class="row">
<div class="col-lg-3 col-sm-6">
<div class="dash-count das2">
<div class="dash-counts">
<h4>{{ result.total }}</h4>
<h5>Total Forecast</h5>
</div>
<div class="dash-imgs">
<i data-feather="trending-up"></i>
</div>
</div>
</div>

<div class="col-lg-3 col-sm-6">
<div class="dash-count das1">
<div class="dash-counts">
<h4>{{ result.current }}</h4>
<h5>Current Stock</h5>
</div>
<div class="dash-imgs">
<i data-feather="package"></i>
</div>
</div>
</div>

<div class="col-lg-3 col-sm-6">
<div class="dash-count {% if result.enough %}das3{% else %}das4{% endif %}">
<div class="dash-counts">
<h4>{{ result.shortage }}</h4>
<h5>Shortage</h5>
</div>
<div class="dash-imgs">
<i data-feather="alert-triangle"></i>
</div>
</div>
</div>

<div class="col-lg-3 col-sm-6">
<div class="dash-count {% if result.enough %}das3{% else %}das4{% endif %}">
<div class="dash-counts">
<h4>{% if result.enough %}✓{% else %}✗{% endif %}</h4>
<h5>Status</h5>
</div>
<div class="dash-imgs">
<i data-feather="{% if result.enough %}check-circle{% else %}x-circle{% endif %}"></i>
</div>
</div>
</div>
</div>

<div class="card">
<div class="card-body">
<h4 class="card-title">
Forecast Details - {{ selected.name }}
</h4>

{% if not result.enough %}
<div class="alert alert-warning">
<strong>⚠️ Stock Alert:</strong> Need to restock {{ result.shortage }} {{ selected.unit }}
</div>
{% else %}
<div class="alert alert-success">
<strong>✓ Stock Sufficient:</strong> Enough inventory for forecasted demand
</div>
{% endif %}

<div class="table-responsive">
<table class="table table-striped">
<thead>
<tr>
<th>Date</th>
<th>Day</th>
<th>Predicted Quantity</th>
</tr>
</thead>
<tbody>
{% for item in result.forecast %}
<tr>
<td>{{ item.date }}</td>
<td>{{ item.day }}</td>
<td><strong>{{ item.quantity }} {{ selected.unit }}</strong></td>
</tr>
{% endfor %}
</tbody>
<tfoot>
<tr class="table-active">
<th colspan="2">Total</th>
<th>{{ result.total }} {{ selected.unit }}</th>
</tr>
</tfoot>
</table>
</div>
</div>
</div>
{% endif %}

</div>
</div>

{% endblock %}